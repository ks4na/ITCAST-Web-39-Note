var Util={isUnique:function(a){var c={};for(var b=0;b<a.length;b++){if(c[a[b]]){return false}else{c[a[b]]=1}}return true},arrayDiff:function(d,c){for(var f=0;f<c.length;f++){for(var e=0;e<d.length;e++){if(d[e]==c[f]){d.splice(e,1);e=e-1}}}return d}};(function(b,c){b.Food=a;function a(e,d){d=d||{};this.width=d.width||25;this.height=d.height||25;this.color=d.color||"green";this.posX=d.posX||0;this.posY=d.posY||0;this.htmlEle=null;this.init(e)}a.prototype.init=function(d){var e=document.createElement("div");d.appendChild(e);e.style.width=this.width+"px";e.style.height=this.height+"px";e.style.backgroundColor=this.color;e.style.position="absolute";e.style.left=this.posX+"px";e.style.top=this.posY+"px";this.htmlEle=e};a.prototype.render=function(){var d=this.htmlEle;d.style.width=this.width;d.style.height=this.height;d.style.backgroundColor=this.color;d.style.left=this.posX+"px";d.style.top=this.posY+"px"};a.prototype.isEaten=function(f){var e=f.bodyUnits[0].posX;var d=f.bodyUnits[0].posY;if(e===this.posX&&d===this.posY){return true}else{return false}};a.prototype.changePosition=function(d,n){var e=Math.floor(d.width/this.width);var f=Math.floor(d.height/this.height);var m=[];for(var k=0;k<e;k++){var p=k*this.width;for(var h=0;h<f;h++){var r=h*this.height;m.push(p+"x"+r)}}var o=[];for(var k=0;k<n.bodyUnits.length;k++){var q=n.bodyUnits[k];o.push(q.posX+"x"+q.posY)}var g=Util.arrayDiff(m,o);if(g.length<=0){throw new Error("没有剩余空间放置食物")}var l=Math.floor(Math.random()*g.length);this.posX=parseInt(g[l].split("x")[0]);this.posY=parseInt(g[l].split("x")[1])}})(window);(function(b,d){b.Snake=a;function a(f,e){e=e||{};this.initLen=e.initLen||3;this.bodyUnits=[];this.bodyUnitWidth=e.bodyUnitWidth||25;this.bodyUnitHeight=e.bodyUnitHeight||25;this.posX=e.posX||100;this.posY=e.posY||300;this.snakeHeadColor=e.snakeHeadColor||"red";this.snakeBodyColor=e.snakeBodyColor||"blue";this.moveDirection=e.moveDirection||"up";this.init(f)}a.prototype.init=function(j){for(var f=0;f<this.initLen;f++){var e={};e.color=f===0?this.snakeHeadColor:this.snakeBodyColor;e.posX=this.posX;e.posY=this.posY+f*this.bodyUnitHeight;e.width=this.bodyUnitWidth;e.height=this.bodyUnitHeight;var g=new c(e);this.bodyUnits.push(g)}for(var f=0;f<this.bodyUnits.length;f++){var h=this.bodyUnits[f];j.appendChild(h.htmlEle)}};a.prototype.render=function(){for(var e=0;e<this.bodyUnits.length;e++){var f=this.bodyUnits[e];f.render()}};a.prototype.changeDirection=function(e){if(this.moveDirection==="up"&&e==="down"||this.moveDirection==="down"&&e==="up"||this.moveDirection==="left"&&e==="right"||this.moveDirection==="right"&&e==="left"){return}this.moveDirection=e};a.prototype.move=function(){for(var e=this.bodyUnits.length-1;e>0;e--){this.bodyUnits[e].posX=this.bodyUnits[e-1].posX;this.bodyUnits[e].posY=this.bodyUnits[e-1].posY}var f=this.bodyUnits[0];switch(this.moveDirection){case"up":f.posY-=f.height;this.posY=f.posY;break;case"down":f.posY+=f.height;this.posY=f.posY;break;case"left":f.posX-=f.width;this.posX=f.posX;break;case"right":f.posX+=f.width;this.posX=f.posX;break;default:}};a.prototype.isTouchEdge=function(g){var f=g.width-this.bodyUnitWidth;var e=g.height-this.bodyUnitWidth;if(this.posX<=f&&this.posX>=0&&this.posY>=0&&this.posY<=e){return false}return true};a.prototype.isTouchSelf=function(){var g=[];for(var e=0;e<this.bodyUnits.length;e++){var f=this.bodyUnits[e];g.push(f.posX+"x"+f.posY)}return !Util.isUnique(g)};a.prototype.addBodyLength=function(){var g=this.bodyUnits[this.bodyUnits.length-1].htmlEle;var j=parseInt(g.style.left);var i=parseInt(g.style.top);var f={};f.color=this.snakeBodyColor;f.posX=j;f.posY=i;f.width=this.bodyUnitWidth;f.height=this.bodyUnitHeight;var h=new c(f);this.bodyUnits.push(h);var e=this.bodyUnits[0].htmlEle.parentNode;e.appendChild(h.htmlEle)};function c(e){e=e||{};this.width=e.width||25;this.height=e.height||25;this.color=e.color||"white";this.posX=e.posX||0;this.posY=e.posY||0;this.htmlEle=null;this.init()}c.prototype.init=function(){var e=document.createElement("div");this.htmlEle=e;e.style.position="absolute";e.style.width=this.width+"px";e.style.height=this.height+"px";e.style.backgroundColor=this.color;e.style.left=this.posX+"px";e.style.top=this.posY+"px"};c.prototype.render=function(){var e=this.htmlEle;e.style.width=this.width+"px";e.style.height=this.height+"px";e.style.backgroundColor=this.color;e.style.left=this.posX+"px";e.style.top=this.posY+"px"}})(window);(function(b,c){b.Map=a;function a(d,e){e=e||{};this.width=e.width||800;this.height=e.height||600;this.backgroundColor=e.backgroundColor||"lightgray";this.htmlEle=null;this.initMap(d)}a.prototype.initMap=function(d){var e=document.createElement("div");e.style.width=this.width+"px";e.style.height=this.height+"px";e.style.backgroundColor=this.backgroundColor;e.style.position="relative";d.appendChild(e);this.htmlEle=e};a.prototype.render=function(){var d=this.htmlEle;d.style.width=this.width+"px";d.style.height=this.height+"px";d.style.backgroundColor=this.backgroundColor
}})(window);(function(a,b){a.Game=c;function c(d,e){e=e||{};this.map=null;this.food=null;this.snake=null;this.isPaused=true;this.isGameOver=false;this.isCompleted=false;this.timerId=null;this.freshFreq=e.freshFreq||300;this.initGame(d)}c.prototype.initGame=function(g){var f=document.createElement("p");f.innerText="空格 = 暂停/开始  |  方向键 = 移动";g.appendChild(f);var e=new Map(g);this.map=e;var h=new Food(this.map.htmlEle);this.food=h;var d=new Snake(this.map.htmlEle);this.snake=d;this.food.changePosition(this.map,this.snake);this.food.render()};c.prototype.run=function(){if(!a.onkeydown){a.onkeydown=function(f){switch(f.keyCode){case 32:this.ChangePauseStatus();break;case 37:this.snake.changeDirection("left");d();clearInterval(this.timerId);this.run();break;case 38:this.snake.changeDirection("up");d();clearInterval(this.timerId);this.run();break;case 39:this.snake.changeDirection("right");d();clearInterval(this.timerId);this.run();break;case 40:this.snake.changeDirection("down");d();clearInterval(this.timerId);this.run();break;default:}}.bind(this)}var d=function(){if(this.shouldContinue()){this.snake.move();this.updateGameStatus();this.render()}else{clearInterval(this.timerId)}}.bind(this);this.timerId=setInterval(d,this.freshFreq)};c.prototype.shouldContinue=function(){return !this.isPaused&&!this.isGameOver&&!this.isCompleted};c.prototype.updateGameStatus=function(){if(this.checkIsCompleted()){this.isCompleted=true;return}if(this.snake.isTouchEdge(this.map)||this.snake.isTouchSelf()){this.isGameOver=true;return}if(this.food.isEaten(this.snake)){this.food.changePosition(this.map,this.snake);this.snake.addBodyLength()}};c.prototype.checkIsCompleted=function(){var d=this.map,m=this.food,n=this.snake;var f=Math.floor(d.width/m.width);var g=Math.floor(d.height/m.height);var e=0;for(var k=0;k<f;k++){for(var h=0;h<g;h++){e++}}var l=n.bodyUnits.length;if(e===l){return true}return false};c.prototype.render=function(){if(this.isCompleted){alert("恭喜，成功通关");return}if(this.isGameOver){alert("Game Over");return}this.snake.render();this.food.render()};c.prototype.ChangePauseStatus=function(){this.isPaused=!this.isPaused;if(!this.isPaused){this.run()}}})(window);(function(b,c){var a=new Game(document.body);a.run()})(window);